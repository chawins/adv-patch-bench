# Config file for both generating and evaluating adversarial patches.
# See argparse.py for how this file is loaded, automatically set params, and
# detailed descriptions of params.

eval:
  seed: 0
  num_gpus: 1  # Number of GPUs to use
  workers: 8  # Number of CPU workers
  config_file: './configs/faster_rcnn_R_50_FPN_3x.yaml'  # Detectron2 config
  base_dir: './detectron_output/'
  data_dir: '~/data/mapillary_vistas/'
  dataset: 'reap'  # dataset name: 'reap', 'synthetic', 'mapillary-SPLIT-no_color', 'mtsd-SPLIT'
  # Sample dimension (height, width); comma-separated
  padded_imgsz: '1536,2048'
  # Path to annotation file
  tgt_csv_filepath: 'mapillary_vistas_final_merged.csv'
  # Custom experiment name (null for auto-generated)
  name: 'synthetic-10x10-obj64-pd64-ld0.00001'
  obj_class: 1  # Class of object to eval/attack
  patch_size_inch: '10x10'
  num_eval: 10  # Number of samples to use for eval  
  # Path to txt file containing file names to use for generating patch or avoid
  # during evaluation
  img_txt_path: null
  # True for generating patch, False for testing, null to automatically set
  run_only_img_txt: null
  interp: 'bilinear'  # Interpolation mode: 'nearest', 'bilinear', 'bicubic'
  save_images: True
  annotated_signs_only: True
  attack_type: 'load'
  iou_thres: 0.5
  verbose: True

  # REAP benchmark params
  reap_transform_mode: 'perspective'  # Transform mode for patch during eval
  reap_use_relight: True

  # Synthetic benchmark params
  syn_obj_width_px: 64
  syn_rotate: 15
  syn_scale: null
  syn_colorjitter: null
  syn_3d_dist: null
  
  # Path to model weight
  weights: './detectron_output/faster_rcnn_R_50_FPN_mtsd_no_color_2/model_best.pth'
  conf_thres: 0.634  # Confidence score threshold to consider detection

  # Visualization
  num_vis: 10
  vis_conf_thresh: null  # Set to conf_thres if not specified
  vis_show_bbox: True

# Attack algorithm params
attack:
  common:
    attack_name: 'rp2'
    aug_prob_geo: 1
    aug_rotate: 15
    aug_scale: null
    aug_3d_dist: null
    aug_prob_colorjitter: 0
    aug_colorjitter: 0.3
    use_patch_relight: True
    patch_dim: 64
    num_bg: 50  # Number of backgrounds attacker uses to generate patch
    transform_mode: 'perspective'
    
  rp2:
    attack_mode: ''
    lambda: 1.0e-5
    min_conf: 0
    num_eot: 1
    num_steps: 1000
    optimizer: 'adam'  # 'adam', 'sgd', 'pgd'
    step_size: 0.01
    use_lr_schedule: False
    # var_change_ab: Use variable change on alpha, beta 
    # attack_mode: 'var_change_ab'
    detectron:
      obj_loss_const: 0
      iou_thres: 0

# Shapeshifter attack
# https://github.com/shangtse/robust-physical-attack/blob/master/Makefile#L76
# rp2:
#   min_conf: 0
#   augment_prob_geometric: 1
#   augment_prob_relight: 0
# detectron:
#   obj_loss_const: 0
#   iou_thres: 0